Bottom: e1c537680f8604351a746b52e83266c2f160373c
Top:    e9b46b0149df07b69b70a643d70c698755f8710f
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2011-10-01 14:08:01 +0100

toporouter.c: Re-arrange the maths in vertices_on_line() to be simpler

Should given an identical result, but with a couple fewer operations.


---

diff --git a/src/toporouter.c b/src/toporouter.c
index 4221937..8060b13 100644
--- a/src/toporouter.c
+++ b/src/toporouter.c
@@ -1178,36 +1178,39 @@ print_toporouter_vertex(toporouter_vertex_t *tv)
 
 /**
  * vertices_on_line:
- * Given vertex a, gradient m, and radius r: 
+ * Given vertex a, gradient m, and radius r:
  *
  * Return vertices on line of a & m at r from a
  */ 
-void
-vertices_on_line(toporouter_spoint_t *a, gdouble m, gdouble r, toporouter_spoint_t *b0, toporouter_spoint_t *b1)
+static void
+vertices_on_line (toporouter_spoint_t *a,
+                  double m,
+                  double r,
+                  toporouter_spoint_t *b0,
+                  toporouter_spoint_t *b1)
 {
 
-  gdouble c, temp;
-  
+  double c, dx;
+
   if(m == INFINITY || m == -INFINITY) {
-    b0->y = a->y + r;
-    b1->y = a->y - r;
 
     b0->x = a->x;
+    b0->y = a->y + r;
+
     b1->x = a->x;
-  
+    b1->y = a->y - r;
+
     return;
   }
 
-  c = a->y - (m * a->x);
-
-  temp = sqrt( pow(r, 2) / ( 1 + pow(m, 2) ) );
+  c = a->y - m * a->x;
+  dx = r / sqrt (1 + pow (m, 2));
 
-  b0->x = a->x + temp;
-  b1->x = a->x - temp;
-  
-  b0->y = b0->x * m + c;
-  b1->y = b1->x * m + c;
+  b0->x = a->x + dx;
+  b0->y = m * b0->x + c;
 
+  b1->x = a->x - dx;
+  b1->y = m * b1->x + c;
 }
 
 /**
