Bottom: 59e8629828cc1b995af232067acd860de75f9e9a
Top:    59e8629828cc1b995af232067acd860de75f9e9a
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2011-09-14 21:58:28 +0100

undo.c: Handle undo failures in a more sane manner

Our current error-case handling can cause serial number inconsistency
when something goes wrong when performing an Undo operation. There are
also various logic flaws in our handling, as it only catches failures
where every sub-undo operation with that serial number fails.

Remove the confusing do-loop which decrements the serial number in the
failure case, and return some sensible error message instead.

This patch also removes the code which looked like it was intended to
loop over the undo stack until a serial number was found to operate on.
It is advantageous for code like the DRC to be able to add increment
the undo serial number, then safely perform an Undo - even if there were
no changes logged in the undo system during the previous serial number.


---


