Bottom: e07c3008df28051ee1fa970146305a15545e7b5e
Top:    7c3647929a90a41522954d83ee8f6ba511af1854
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2009-11-15 23:31:10 +0000

Benchmark no-holes dicer performance


---

diff --git a/src/hid/common/draw_helpers.c b/src/hid/common/draw_helpers.c
index 1c7ead9..76dcccf 100644
--- a/src/hid/common/draw_helpers.c
+++ b/src/hid/common/draw_helpers.c
@@ -143,6 +143,8 @@ void common_fill_pcb_polygon (hidGC gc, PolygonType *poly,
             we are dicing for every case. Some GUIs
             rely on this, and need their flags fixing. */
 
+  NoHolesPolygonDicer (poly, clip_box, fill_contour_cb, gc);
+#if 0
   if (!poly->NoHolesValid)
     {
       /* If enough of the polygon is on-screen, compute the entire
@@ -166,6 +168,7 @@ void common_fill_pcb_polygon (hidGC gc, PolygonType *poly,
             fill_clipped_contour (gc, pl, clip_box);
         }
     }
+#endif
 
   /* Draw other parts of the polygon if fullpoly flag is set */
   /* NB: No "NoHoles" cache for these */
diff --git a/src/hid/ps/ps.c b/src/hid/ps/ps.c
index 810ceba..2db29bb 100644
--- a/src/hid/ps/ps.c
+++ b/src/hid/ps/ps.c
@@ -418,6 +418,8 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   int i;
   static int saved_layer_stack[MAX_LAYER];
   FlagType save_thindraw;
+  clock_t start, end;
+  double elapsed;
 
   save_thindraw = PCB->Flags;
   CLEAR_FLAG(THINDRAWFLAG, PCB);
@@ -510,6 +512,8 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   region.X2 = PCB->MaxWidth;
   region.Y2 = PCB->MaxHeight;
 
+  start = clock ();
+
   if (! multi_file)
     {
       fprintf (f, "%%%%Page: TableOfContents 1\n");  /* %%Page DSC requires both a label and an ordinal */
@@ -530,6 +534,10 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   lastgroup = -1;
   hid_expose_callback (&ps_hid, &region, 0);
 
+  end = clock ();
+  elapsed = ((double) (end - start)) / CLOCKS_PER_SEC;
+  printf ("Printing file took %f\n", elapsed);
+
   if (f)
     fprintf (f, "showpage\n");
 
@@ -1354,7 +1362,7 @@ HID ps_hid = {
   ps_draw_rect,
   ps_fill_circle,
   ps_fill_polygon,
-  ps_fill_pcb_polygon,
+  common_fill_pcb_polygon /* ps_fill_pcb_polygon */,
   0 /* ps_thindraw_pcb_polygon */,
   ps_fill_rect,
   ps_calibrate,
