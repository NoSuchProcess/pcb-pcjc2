Bottom: 998a41ac1598aece8469c2a9390924a614ab033e
Top:    36fcb9e9279063541d3a10ec93942723219e403b
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2009-11-15 02:44:22 +0000

Benchmark no-holes dicer performance


---

diff --git a/src/hid/common/draw_helpers.c b/src/hid/common/draw_helpers.c
index 1c7ead9..76dcccf 100644
--- a/src/hid/common/draw_helpers.c
+++ b/src/hid/common/draw_helpers.c
@@ -143,6 +143,8 @@ void common_fill_pcb_polygon (hidGC gc, PolygonType *poly,
             we are dicing for every case. Some GUIs
             rely on this, and need their flags fixing. */
 
+  NoHolesPolygonDicer (poly, clip_box, fill_contour_cb, gc);
+#if 0
   if (!poly->NoHolesValid)
     {
       /* If enough of the polygon is on-screen, compute the entire
@@ -166,6 +168,7 @@ void common_fill_pcb_polygon (hidGC gc, PolygonType *poly,
             fill_clipped_contour (gc, pl, clip_box);
         }
     }
+#endif
 
   /* Draw other parts of the polygon if fullpoly flag is set */
   /* NB: No "NoHoles" cache for these */
diff --git a/src/hid/ps/ps.c b/src/hid/ps/ps.c
index 9abe279..2ce9d92 100644
--- a/src/hid/ps/ps.c
+++ b/src/hid/ps/ps.c
@@ -9,6 +9,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include <assert.h>
+#include <time.h>
 
 #include "global.h"
 #include "data.h"
@@ -311,6 +312,8 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   int i;
   static int saved_layer_stack[MAX_LAYER];
   FlagType save_thindraw;
+  clock_t start, end;
+  double elapsed;
 
   save_thindraw = PCB->Flags;
   CLEAR_FLAG(THINDRAWFLAG, PCB);
@@ -403,6 +406,8 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   region.X2 = PCB->MaxWidth;
   region.Y2 = PCB->MaxHeight;
 
+  start = clock ();
+
   if (! multi_file)
     {
       pagecount = 1;
@@ -422,6 +427,10 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   lastgroup = -1;
   hid_expose_callback (&ps_hid, &region, 0);
 
+  end = clock ();
+  elapsed = ((double) (end - start)) / CLOCKS_PER_SEC;
+  printf ("Printing file took %f\n", elapsed);
+
   if (f)
     fprintf (f, "showpage\n");
