Bottom: 303ba53fd57b842e6f75a7b73ea0229146403b36
Top:    a0f68f63cb1211ab617d18927e3122527d2cc3a1
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2009-11-12 14:11:33 +0000

Benchmark no-holes dicer performance


---

diff --git a/src/hid/common/draw_helpers.c b/src/hid/common/draw_helpers.c
index fa2df9b..6190b0b 100644
--- a/src/hid/common/draw_helpers.c
+++ b/src/hid/common/draw_helpers.c
@@ -70,6 +70,8 @@ void common_fill_pcb_polygon (hidGC gc, PolygonType *poly,
             we are dicing for every case. Some GUIs
             rely on this, and need their flags fixing. */
 
+  NoHolesPolygonDicer (poly, clip_box, fill_contour_cb, gc);
+#if 0
   if (!poly->NoHolesValid)
     {
       ComputeNoHoles (poly);
@@ -81,6 +83,7 @@ void common_fill_pcb_polygon (hidGC gc, PolygonType *poly,
       for (pl = poly->NoHoles; pl != NULL; pl = pl->next)
         fill_contour (gc, pl);
     }
+#endif
 
   /* Draw other parts of the polygon if fullpoly flag is set */
   /* NB: No "NoHoles" cache for these */
diff --git a/src/hid/ps/ps.c b/src/hid/ps/ps.c
index 9abe279..2ce9d92 100644
--- a/src/hid/ps/ps.c
+++ b/src/hid/ps/ps.c
@@ -9,6 +9,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include <assert.h>
+#include <time.h>
 
 #include "global.h"
 #include "data.h"
@@ -311,6 +312,8 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   int i;
   static int saved_layer_stack[MAX_LAYER];
   FlagType save_thindraw;
+  clock_t start, end;
+  double elapsed;
 
   save_thindraw = PCB->Flags;
   CLEAR_FLAG(THINDRAWFLAG, PCB);
@@ -403,6 +406,8 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   region.X2 = PCB->MaxWidth;
   region.Y2 = PCB->MaxHeight;
 
+  start = clock ();
+
   if (! multi_file)
     {
       pagecount = 1;
@@ -422,6 +427,10 @@ ps_hid_export_to_file (FILE * the_file, HID_Attr_Val * options)
   lastgroup = -1;
   hid_expose_callback (&ps_hid, &region, 0);
 
+  end = clock ();
+  elapsed = ((double) (end - start)) / CLOCKS_PER_SEC;
+  printf ("Printing file took %f\n", elapsed);
+
   if (f)
     fprintf (f, "showpage\n");
