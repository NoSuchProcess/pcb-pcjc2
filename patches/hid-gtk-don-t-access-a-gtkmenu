Bottom: ce7954e341082ec5c8249e494d1f33a77dff6375
Top:    e5eeba648f910111a195c7fd5cb905efe059b05c
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2011-09-05 16:42:18 +0100

hid/gtk: Don't access a GtkMenuShell's children directly

In GTK3.0, direct access to shell->children will be impossible.


---

diff --git a/src/hid/gtk/ghid-main-menu.c b/src/hid/gtk/ghid-main-menu.c
index 6b58485..0294a0e 100644
--- a/src/hid/gtk/ghid-main-menu.c
+++ b/src/hid/gtk/ghid-main-menu.c
@@ -343,20 +343,27 @@ ghid_main_menu_real_add_resource (GHidMainMenu *menu, GtkMenuShell *shell,
           /* If we get here, the resource is "-" or "@foo" for some foo */
           if (res->v[i].value[0] == '@')
             {
+              GList *children;
+              int pos;
+
+              children = gtk_container_get_children (GTK_CONTAINER (shell));
+              pos = g_list_length (shell->children);
+              g_list_free (children);
+
               if (strcmp (res->v[i].value, "@layerview") == 0)
                 {
                   menu->layer_view_shell = shell;
-                  menu->layer_view_pos = g_list_length (shell->children);
+                  menu->layer_view_pos = pos;
                 }
               else if (strcmp (res->v[i].value, "@layerpick") == 0)
                 {
                   menu->layer_pick_shell = shell;
-                  menu->layer_pick_pos = g_list_length (shell->children);
+                  menu->layer_pick_pos = pos;
                 }
               else if (strcmp (res->v[i].value, "@routestyles") == 0)
                 {
                   menu->route_style_shell = shell;
-                  menu->route_style_pos = g_list_length (shell->children);
+                  menu->route_style_pos = pos;
                 }
               else
                 Message (_("GTK GUI currently ignores \"%s\" in the menu\n"
