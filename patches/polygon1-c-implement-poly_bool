Bottom: c1fdac80e6e50d930e643dfac0373c804d423ddb
Top:    13dcc5c68f0fb33a8a9b3f143ea231cbb81e35db
Author: Peter Clifton <pcjc2@cam.ac.uk>
Date:   2009-02-10 15:29:00 +0000

polygon1.c: Implement poly_Boolean() by calling poly_Boolean_free()

Reduces duplicated code. The poly_Boolean() implemetation already
copied the original contours, then duplicated the processing steps
taken in poly_Boolean_free().







---

diff --git a/src/polygon1.c b/src/polygon1.c
index 2d4fbe9..3bac8c4 100644
--- a/src/polygon1.c
+++ b/src/polygon1.c
@@ -1744,51 +1744,11 @@ poly_Boolean (const POLYAREA * a_org, const POLYAREA * b_org,
 	      POLYAREA ** res, int action)
 {
   POLYAREA *a = NULL, *b = NULL;
-  PLINE *p, *holes = NULL;
-  jmp_buf e;
-  int code;
-
-  *res = NULL;
-
-  if ((code = setjmp (e)) == 0)
-    {
-      if (!poly_M_Copy0 (&a, a_org) || !poly_M_Copy0 (&b, b_org))
-	longjmp (e, err_no_memory);
-
-#ifdef DEBUG
-      if (!poly_Valid (a))
-	return -1;
-      if (!poly_Valid (b))
-	return -1;
-#endif
-      M_POLYAREA_intersect (&e, a, b, TRUE);
-
-      M_POLYAREA_label (a, b, FALSE);
-      M_POLYAREA_label (b, a, FALSE);
-
-      M_POLYAREA_Collect (&e, a, res, &holes, action, b->f == b
-			  && !b->contours->next
-			  && b->contours->Flags.status != ISECTED);
-      poly_Free (&a);
-      M_B_AREA_Collect (&e, b, res, &holes, action);
-      poly_Free (&b);
 
-      InsertHoles (&e, *res, &holes);
-    }
-  /* delete holes */
-  while ((p = holes) != NULL)
-    {
-      holes = p->next;
-      poly_DelContour (&p);
-    }
+  if (!poly_M_Copy0 (&a, a_org) || !poly_M_Copy0 (&b, b_org))
+    return err_no_memory;
 
-  if (code)
-    {
-      poly_Free (res);
-      return code;
-    }
-  assert (!*res || poly_Valid (*res));
-  return code;
+  return poly_Boolean_free (a, b, res, action);
 }				/* poly_Boolean */
 
 /* just like poly_Boolean but frees the input polys */
